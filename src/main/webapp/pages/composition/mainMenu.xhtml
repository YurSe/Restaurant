<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:c="http://java.sun.com/jsp/jstl/core"
        xmlns:f="http://java.sun.com/jsf/core">
    <h:form>
        <!-- <p:menuitem value="Услуги" outcome="/pages/services?faces-redirect=true"/>
             Закоментил что бы не появлялся 2 уровень меню, у админа.
          -->
        <p:menubar>
            <p:menuitem value="Home" style="margin-right:0.5em" outcome="/pages/index?faces-redirect=true"/>
            <p:menuitem value="Menu" style="margin-right:0.5em" outcome="/pages/menu?faces-redirect=true"/>
            <p:menuitem value="Reserve table" style="margin-right:0.5em"
                        outcome="/pages/zones?faces-redirect=true"/>
            <p:menuitem value="Search" style="margin-right:0.5em" outcome="/pages/search?faces-redirect=true"/>
            <p:menuitem value="Gallery" style="margin-right:0.5em" outcome="/pages/gallery?faces-redirect=true"/>
            <p:menuitem value="Events" style="margin-right:0.5em" outcome="/pages/events?faces-redirect=true"/>
            <p:menuitem value="Contacts" style="margin-right:0.5em" outcome="/pages/contacts?faces-redirect=true"/>
            <p:menuitem value="About" style="margin-right:0.5em" outcome="/pages/about?faces-redirect=true"/>

            <p:submenu label="Admin" style="margin-right:0.5em;"
                       rendered="#{springUserController.IsAdmin()}">
                <p:menuitem value="Users list" outcome="/pages/accountAdmin?faces-redirect=true"/>
                <p:menuitem value="Users messages" outcome="/pages/userMessages?faces-redirect=true"/>
            </p:submenu>

            <f:facet name="options">
                <div style="float: right;">

                    <h:commandButton id="basketButton" value="Cart" type="button"
                                     styleClass="btn btn-success"
                                     style="margin-right:1em"
                                     rendered="#{springUserController.IsAuthorized()}"
                                     onclick="PF('basketPanelVar').loadContents()"/>

                    <h:commandButton id="Account" value="Account" action="/pages/account?faces-redirect=true"
                                     styleClass="btn btn-info" style="margin-right:1em"
                                     rendered="#{springUserController.IsAuthorized()}"/>

                    <h:commandButton id="AccountAdmin" value="Admin account"
                                     styleClass="btn btn-warning" style="margin-right:1em"
                                     action="/pages/accountAdmin?faces-redirect=true"
                                     rendered="#{springUserController.IsAdmin()}"/>

                    <h:commandButton ajax="false" value="Log out" action="${springUserController.logout()}"
                                     styleClass="btn btn-danger"
                                     rendered="#{springUserController.IsAuthorized()}"/>

                    <h:commandButton id="LogIn" value="Log in" action="/pages/login?faces-redirect=true"
                                     styleClass="btn btn-success" style="margin-right:1em"
                                     rendered="#{!springUserController.IsAuthorized()}"/>
                    <h:commandButton id="Registration" value="Sign up" action="/pages/register?faces-redirect=true"
                                     styleClass="btn btn-info"
                                     rendered="#{!springUserController.IsAuthorized()}"/>
                </div>
            </f:facet>
        </p:menubar>

        <p:overlayPanel id="basketPanel" for="basketButton" hideEffect="fade" dynamic="true" style="width:50%;"
                        widgetVar="basketPanelVar">
            <p:dataTable id="basketDataTable" var="dish" value="#{reservation.dishes.entrySet()}" rows="4"
                         emptyMessage="Empty cart" paginator="true">
                <p:column headerText="Name">
                    <h:outputText value="#{dish.key.name}"/>
                </p:column>

                <p:column headerText="Price">
                    <h:outputText value="#{dish.key.price}"/>
                </p:column>

                <p:column headerText="Count">
                    <h:outputText value="#{reservation.dishes[dish.key]}"/>

                </p:column>

                <p:column headerText="Delete" style="width: 20%;">
                    <h:commandButton value="X" styleClass="btn btn-danger"
                                     update="basketDataTable"
                                     action="#{reservation.RemoveDish(dish.key)}"/>
                </p:column>
            </p:dataTable>

            <p:commandButton value="Make order" rendered="#{!reservation.IsDishesEmpty()}"
                             onclick="PF('basketPanelVar').update()"
                             actionListener="#{reservation.createOrder()}"/>

            <p:commandButton value="Cancel" rendered="#{!reservation.IsDishesEmpty()}"
                             onclick="PF('basketPanelVar').update()"
                             actionListener="#{reservation.Clear()}"/>

            <h:outputText value="Total = #{reservation.fullPrice}" style="position:relative; float:right;"/>

        </p:overlayPanel>

    </h:form>
</ui:composition>
