<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:c="http://java.sun.com/jsp/jstl/core"
        xmlns:f="http://java.sun.com/jsf/core">
    <h:form>
        <!-- <p:menuitem value="Услуги" outcome="/pages/services?faces-redirect=true"/>
             Закоментил что бы не появлялся 2 уровень меню, у админа.
          -->
        <p:menubar>
            <p:menuitem value="Главная" style="margin-right:0.5em" outcome="/pages/index?faces-redirect=true"/>
            <p:menuitem value="Меню" style="margin-right:0.5em" outcome="/pages/menu?faces-redirect=true"/>
            <p:menuitem value="Забронировать столик" style="margin-right:0.5em"
                        outcome="/pages/zones?faces-redirect=true"/>
            <p:menuitem value="Поиск" style="margin-right:0.5em" outcome="/pages/search?faces-redirect=true"/>
            <p:menuitem value="Галерея" style="margin-right:0.5em" outcome="/pages/gallery?faces-redirect=true"/>
            <p:menuitem value="События" style="margin-right:0.5em" outcome="/pages/events?faces-redirect=true"/>
            <p:menuitem value="Контакты" style="margin-right:0.5em" outcome="/pages/contacts?faces-redirect=true"/>
            <p:menuitem value="О ресторане" style="margin-right:0.5em" outcome="/pages/about?faces-redirect=true"/>

            <f:facet name="options">
                <div style="float: right;">
                    <h:commandButton id="basketButton" value="Корзина" type="button"
                                     styleClass="btn btn-success"
                                     style="margin-right:1em"
                                     rendered="#{springUserController.IsAuthorized()}"
                                     onclick="PF('basketPanelVar').loadContents()"/>

                    <h:commandButton id="Account" value="Личный кабинет" action="/pages/account?faces-redirect=true"
                                     styleClass="btn btn-info" style="margin-right:1em"
                                     rendered="#{springUserController.IsAuthorized()}"/>

                    <h:commandButton id="AccountAdmin" value="Кабинет администратора"
                                     styleClass="btn btn-warning" style="margin-right:1em"
                                     action="/pages/accountAdmin?faces-redirect=true"
                                     rendered="#{springUserController.IsAdmin()}"/>

                    <h:commandButton ajax="false" value="Выйти" action="${springUserController.logout()}"
                                     styleClass="btn btn-danger"
                                     rendered="#{springUserController.IsAuthorized()}"/>

                    <h:commandButton id="LogIn" value="Войти" action="/pages/login?faces-redirect=true"
                                     styleClass="btn btn-success" style="margin-right:1em"
                                     rendered="#{!springUserController.IsAuthorized()}"/>
                    <h:commandButton id="Registration" value="Регистрация" action="/pages/register?faces-redirect=true"
                                     styleClass="btn btn-info"
                                     rendered="#{!springUserController.IsAuthorized()}"/>
                </div>
            </f:facet>
        </p:menubar>

        <p:overlayPanel id="basketPanel" for="basketButton" hideEffect="fade" dynamic="true" style="width:50%;"
                        widgetVar="basketPanelVar">
            <p:dataTable id="basketDataTable" var="dish" value="#{reservation.dishes.entrySet()}" rows="4"
                         emptyMessage="Корзина пуста" paginator="true">
                <p:column headerText="Название">
                    <h:outputText value="#{dish.key.name}"/>
                </p:column>

                <p:column headerText="Цена">
                    <h:outputText value="#{dish.key.price}"/>
                </p:column>

                <p:column headerText="Кол-во">
                    <h:outputText value="#{reservation.dishes[dish.key]}"/>

                </p:column>

                <p:column headerText="Удалить" style="width: 20%;">
                    <h:commandButton value="X" styleClass="btn btn-danger"
                                     update="basketDataTable"
                                     action="#{reservation.RemoveDish(dish.key)}"/>
                </p:column>
            </p:dataTable>

            <p:commandButton value="Заказать" rendered="#{!reservation.IsDishesEmpty()}"
                             actionListener="#{reservation.createOrder()}"/>

            <p:commandButton value="Очистить" rendered="#{!reservation.IsDishesEmpty()}"
                             onclick="PF('basketPanelVar').update()"
                             actionListener="#{reservation.Clear()}"/>

            <h:outputText value="Итого = #{reservation.fullPrice}" style="position:relative; float:right;"/>

        </p:overlayPanel>

    </h:form>
</ui:composition>
