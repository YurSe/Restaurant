<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:p="http://primefaces.org/ui"
        xmlns:c="http://java.sun.com/jsp/jstl/core"
        xmlns:f="http://java.sun.com/jsf/core">
    <h:form>
        <p:menubar>
            <p:menuitem value="Главная" outcome="/pages/index?faces-redirect=true"/>
            <p:menuitem value="Меню" outcome="/pages/menu?faces-redirect=true"/>
            <p:menuitem value="Забронировать столик" outcome="/pages/zones?faces-redirect=true"/>
            <p:menuitem value="Поиск" outcome="/pages/search?faces-redirect=true"/>
            <p:menuitem value="Галерея" outcome="/pages/gallery?faces-redirect=true"/>
            <p:menuitem value="События" outcome="/pages/events?faces-redirect=true"/>
            <p:menuitem value="Услуги" outcome="/pages/services?faces-redirect=true"/>
            <p:menuitem value="Контакты" outcome="/pages/contacts?faces-redirect=true"/>
            <p:menuitem value="О ресторане" outcome="/pages/about?faces-redirect=true"/>

            <f:facet name="options">
                <div style="float: right;">
                    <p:commandButton id="basketButton" value="Корзина" type="button"
                                rendered="#{springUserController.IsAuthorized()}"
                                onclick="PF('basketPanelVar').loadContents()"/>

                    <p:commandButton ajax="false" value="Выйти" action="${springUserController.logout()}"

                    <p:commandButton id="Account" value="Личный кабинет" action="account?faces-redirect=true"
                                     rendered="#{springUserController.IsAuthorized()}"/>

                    <p:commandButton ajax="false" value="Выйти" url="/logout"
                                rendered="#{springUserController.IsAuthorized()}"/>

                    <p:commandButton id="LogIn" value="Войти" action="login?faces-redirect=true"
                                rendered="#{!springUserController.IsAuthorized()}"/>
                    <p:commandButton id="Registration" value="Регистрация" action="register?faces-redirect=true"
                                style="float: right;"
                                rendered="#{!springUserController.IsAuthorized()}"/>
                </div>
            </f:facet>
        </p:menubar>

        <p:overlayPanel id="basketPanel" for="basketButton" hideEffect="fade" dynamic="true" style="width:50%;"
                        widgetVar="basketPanelVar">
            <p:dataTable id="basketDataTable" var="dish" value="#{reservation.dishes.entrySet()}" rows="5"
                         emptyMessage="Корзина пуста"
                         paginator="true">
                <p:column headerText="Название">
                    <h:outputText value="#{dish.key.name}"/>
                </p:column>

                <p:column headerText="Цена">
                    <h:outputText value="#{dish.key.price}"/>
                </p:column>

                <p:column headerText="Кол-во">
                    <h:outputText value="#{reservation.dishes[dish.key]}"/>

                </p:column>

                <p:column headerText="Удалить" style="width: 20%;">
                    <p:commandButton value="X" style="background-color: red;"
                                     update="basketDataTable"
                                     action="#{reservation.RemoveDish(dish.key)}"/>
                </p:column>
            </p:dataTable>

            <p:commandButton value="Заказать" rendered="#{!reservation.IsDishesEmpty()}"
                             actionListener="#{reservation.createOrder()}"/>

            <p:commandButton value="Очистить" rendered="#{!reservation.IsDishesEmpty()}"
                             onclick="PF('basketPanelVar').update()"
                             actionListener="#{reservation.Clear()}"/>

            <h:outputText value="Итого = #{reservation.fullPrice}" style="position:relative; float:right;"/>

        </p:overlayPanel>

    </h:form>
</ui:composition>
